<!-- 这里是关于主对话窗口的表单一 --><!-- 包括旧对话记录和新用户输入 -->document.addEventListener('DOMContentLoaded', () => {    const form = document.getElementById('main-chat-form');    form.addEventListener('submit', async (event) => {        event.preventDefault();        console.log("表单提交，准备连接后端...");        // 后续将用 fetch 提交并刷新 chat-window    });});// 监听prompt列表的变化document.addEventListener('DOMContentLoaded', () => {    // 在html中，Django自动生成presert列表    // promptMap 构建（通过模板输出或 fetch 拉取）    const promptMap = window.promptMap || {};    // 明确将被操作的区域    const radioButtons = document.querySelectorAll('input[name="prompt_option"]');    const textarea = document.querySelector('textarea[name="custom_prompt"]');    // 显示 prompt 内容    radioButtons.forEach(r => {        r.addEventListener('change', () => {            const val = r.value;            if (val in promptMap) {                textarea.value = promptMap[val];            } else {                textarea.value = '';            }        });    });    // 默认加载第一项（页面加载后触发一次 change）    radioButtons[0].dispatchEvent(new Event('change'));    // 打开编辑器并更新prompt内容    const editBtn = document.getElementById('prompt-edit-btn');    const editor = document.getElementById('prompt-editor');    const nameInput = document.getElementById('edit-name');    // name会显示在list上    const contentInput = document.getElementById('edit-content');    // content是具体prompt内容，会显示在custom中    let currentSelected = null;    editBtn.addEventListener('click', () => {        // 找到当前被选中的项        currentSelected = document.querySelector('input[name="prompt_option"]:checked');        if (!currentSelected || currentSelected.value === 'custom') return;        const labelSpan = currentSelected.parentElement.querySelector('.prompt-label');        nameInput.value = labelSpan.textContent.trim();        contentInput.value = promptMap[currentSelected.value] || '';        editor.style.display = 'block';    });    document.getElementById('cancel-prompt').addEventListener('click', () => {        editor.style.display = 'none';    });    // 关闭弹窗，check选中状态，并提交prompt表单    document.getElementById('save-prompt').addEventListener('click', () => {        if (!currentSelected) return;        const newName = nameInput.value.trim();        const newContent = contentInput.value;        // 更新页面显示        const labelSpan = currentSelected.parentElement.querySelector('.prompt-label');        labelSpan.textContent = newName;        // 更新映射        promptMap[currentSelected.value] = newContent;        // 填入 textarea        document.querySelector('textarea[name="custom_prompt"]').value = newContent;        // 关闭弹窗        editor.style.display = 'none';        // 自动提交 prompt form（可改为 fetch）        document.getElementById('prompt-form').submit();    });});