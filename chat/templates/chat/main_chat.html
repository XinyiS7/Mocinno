{% load static %}<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <title>Mocinno Chat</title>    <link rel="stylesheet" href="{% static 'chat/style.css' %}">    <script defer src="{% static 'chat/script.js' %}"></script></head><body><div class="container">    <!-- 左侧对话列表 -->    <div class="sidebar">        <h3>对话列表</h3>        <ul id="chat-list">            <!-- 动态加载会话标题 -->        </ul>    </div>    <!-- 主聊天窗：Form 1 -->    <div class="main-chat">        <form id="main-chat-form" method="POST">            {% csrf_token %}            <!-- 聊天记录显示区 -->            <div id="chat-window">                <!-- 聊天记录（通过 JS 渲染） -->                <!-- AI 回复（无边框，左对齐） -->                <div class="chat-message ai">                    <div class="chat-bubble">                        <p><strong>AI:</strong></p>                        <p>你好！这是 <code>AI 模拟回复</code>。支持 <strong>Markdown</strong> 渲染。</p>                    </div>                </div>                <!-- 用户提交（右对齐，带边框） -->                <div class="chat-message user">                    <div class="chat-bubble">                        <p>你能解释一下 Django 的模型是什么吗？</p>                    </div>                </div>            </div>            <!-- 模型选择按钮 -->            <div class="toggle-group">                <label><input type="radio" name="model" value="chat"> chat</label>                <label><input type="radio" name="model" value="reasoner" checked>                    reasoner</label>            </div>            <!-- 摘要模式开关 -->            <div class="toggle-group">                <label><input type="checkbox" name="abstract"> 摘要模式</label>            </div>            <!-- 启发按钮 -->            <div class="toggle-group">                <label><input type="checkbox" name="insight"> 启发 </label>            </div>            <!-- 用户输入 -->            <textarea name="user_input" placeholder="请输入内容..." rows="3"></textarea>            <!-- 提交按钮 -->            <button type="submit">提交</button>        </form>    </div>    <!-- Prompt Container -->    <div class="prompt-box">        <h3>Prompt container</h3>        <!-- 可折叠菜单按钮（简单占位） -->        <div style="text-align: right; margin-bottom: 5px;">            <button type="button" id="prompt-edit-btn">☰</button>        </div>        <!-- 编辑弹窗 -->        <div id="prompt-editor" style="display:none; position:absolute; top:100px; right:280px; background:white; border:1px solid #ccc; padding:10px; z-index:1000;">            <label>名称 <input type="text" id="edit-name"></label><br><br>            <label>内容 <textarea id="edit-content" rows="4" style="width:100%;"></textarea></label><br><br>            <button id="save-prompt">保存</button>            <button id="cancel-prompt">取消</button>        </div>        <!-- 单选框（预设与自定义） -->        <form id="prompt-form">            {% for preset in presets %}                <label>                    <input type="radio" name="prompt_option" value="{{ preset.name }}" {% if forloop.first %}checked{% endif %}>                    <span class="prompt-label">{{ preset.name }}</span>                </label><br>            {% endfor %}            <label><input type="radio" name="prompt_option" value="custom" checked> 自定义prompt</label><br>            <!-- 自定义 prompt 输入框 -->            <textarea name="custom_prompt" placeholder="这里是单选框对应的自定义输入框..." rows="4"></textarea>        </form>    </div></div><script>// 监听prompt列表的变化document.addEventListener('DOMContentLoaded', () => {    // Django自动生成presert列表    const promptMap = {        {% for preset in presets %}            "{{ preset.name }}": `{{ preset.content|escapejs }}`,        {% endfor %}    };    // 明确将被操作的区域    const radioButtons = document.querySelectorAll('input[name="prompt_option"]');    const textarea = document.querySelector('textarea[name="custom_prompt"]');    // 显示 prompt 内容    radioButtons.forEach(r => {        r.addEventListener('change', () => {            const val = r.value;            if (val in promptMap) {                textarea.value = promptMap[val];            } else {                textarea.value = '';            }        });    });    // 默认加载第一项（页面加载后触发一次 change）    radioButtons[0].dispatchEvent(new Event('change'));    // 打开编辑器并更新prompt内容    const editBtn = document.getElementById('prompt-edit-btn');    const editor = document.getElementById('prompt-editor');    const nameInput = document.getElementById('edit-name');    // name会显示在list上    const contentInput = document.getElementById('edit-content');    // content是具体prompt内容，会显示在custom中    let currentSelected = null;    editBtn.addEventListener('click', () => {        // 找到当前被选中的项        currentSelected = document.querySelector('input[name="prompt_option"]:checked');        if (!currentSelected || currentSelected.value === 'custom') return;        const labelSpan = currentSelected.parentElement.querySelector('.prompt-label');        nameInput.value = labelSpan.textContent.trim();        contentInput.value = promptMap[currentSelected.value] || '';        editor.style.display = 'block';    });    document.getElementById('cancel-prompt').addEventListener('click', () => {        editor.style.display = 'none';    });    // 关闭弹窗，check选中状态，并提交prompt表单    document.getElementById('save-prompt').addEventListener('click', () => {        if (!currentSelected) return;        const newName = nameInput.value.trim();        const newContent = contentInput.value;        // 更新页面显示        const labelSpan = currentSelected.parentElement.querySelector('.prompt-label');        labelSpan.textContent = newName;        // 更新映射        promptMap[currentSelected.value] = newContent;        // 填入 textarea        document.querySelector('textarea[name="custom_prompt"]').value = newContent;        // 关闭弹窗        editor.style.display = 'none';        // 自动提交 prompt form（可改为 fetch）        document.getElementById('prompt-form').submit();    });});</script></body></html>